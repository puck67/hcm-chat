<!DOCTYPE html>
<html>
<head>
    <title>Test Profile API</title>
</head>
<body>
    <h1>Test Profile API Endpoints</h1>

    <div>
        <h2>Login First</h2>
        <button onclick="testLogin()">Login as User</button>
        <div id="loginResult"></div>
    </div>

    <div>
        <h2>Test Update Profile</h2>
        <input type="email" id="testEmail" placeholder="New Email" value="test@example.com">
        <input type="text" id="testFullName" placeholder="New Full Name" value="Test User Updated">
        <button onclick="testUpdateProfile()">Test Update Profile</button>
        <div id="updateResult"></div>
    </div>

    <div>
        <h2>Test Change Password</h2>
        <input type="password" id="testCurrentPassword" placeholder="Current Password" value="user123">
        <input type="password" id="testNewPassword" placeholder="New Password" value="newpassword123">
        <button onclick="testChangePassword()">Test Change Password</button>
        <div id="passwordResult"></div>
    </div>

    <script>
        let authToken = null;

        async function testLogin() {
            const result = document.getElementById('loginResult');

            try {
                const response = await fetch('http://localhost:9000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'user1',
                        password: 'user123'
                    })
                });

                const data = await response.json();
                console.log('Login response:', data);

                if (data.success) {
                    authToken = data.data.token;
                    result.innerHTML = '<p style="color: green;">Login successful! Token: ' + authToken.substring(0, 20) + '...</p>';
                } else {
                    result.innerHTML = '<p style="color: red;">Login failed: ' + data.message + '</p>';
                }
            } catch (error) {
                console.error('Login error:', error);
                result.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        async function testUpdateProfile() {
            const result = document.getElementById('updateResult');

            if (!authToken) {
                result.innerHTML = '<p style="color: red;">Please login first!</p>';
                return;
            }

            try {
                const email = document.getElementById('testEmail').value;
                const fullName = document.getElementById('testFullName').value;

                const response = await fetch('http://localhost:9000/api/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    },
                    body: JSON.stringify({
                        email: email,
                        fullName: fullName
                    })
                });

                const data = await response.json();
                console.log('Update profile response:', data);

                if (data.success) {
                    result.innerHTML = '<h3>Profile updated successfully!</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<p style="color: red;">Update failed: ' + data.message + '</p>';
                }
            } catch (error) {
                console.error('Update profile error:', error);
                result.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        async function testChangePassword() {
            const result = document.getElementById('passwordResult');

            if (!authToken) {
                result.innerHTML = '<p style="color: red;">Please login first!</p>';
                return;
            }

            try {
                const currentPassword = document.getElementById('testCurrentPassword').value;
                const newPassword = document.getElementById('testNewPassword').value;

                const response = await fetch('http://localhost:9000/api/auth/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    },
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword,
                        confirmPassword: newPassword
                    })
                });

                const data = await response.json();
                console.log('Change password response:', data);

                if (data.success) {
                    result.innerHTML = '<h3>Password changed successfully!</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<p style="color: red;">Password change failed: ' + data.message + '</p>';
                }
            } catch (error) {
                console.error('Change password error:', error);
                result.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>